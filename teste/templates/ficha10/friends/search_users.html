{% extends 'ficha10/base.html' %}

{% block title %}Pesquisar Utilizadores - Social Event Platform{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900">
            <i class="fas fa-search mr-2 text-blue-600"></i>
            Pesquisar Utilizadores
        </h1>
        <p class="mt-2 text-gray-600">Encontre e conecte-se com novos amigos</p>
    </div>

    <!-- Search Form -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <form method="get" class="flex space-x-4">
            <input type="text" name="q" value="{{ query }}" placeholder="Pesquisar por nome ou username..." 
                   class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                <i class="fas fa-search mr-2"></i>Pesquisar
            </button>
        </form>
    </div>

    <!-- Search Results -->
    {% if query %}
    <div class="bg-white rounded-lg shadow-md">
        {% if users %}
        <div class="divide-y">
            {% for user in users %}
            <div class="p-6 hover:bg-gray-50 transition">
                <div class="flex items-start justify-between">
                    <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0">
                            {% if user.profile_picture_url %}
                            <img class="h-16 w-16 rounded-full object-cover" src="{{ user.profile_picture_url }}" alt="{{ user.username }}">
                            {% else %}
                            <div class="h-16 w-16 rounded-full bg-blue-600 flex items-center justify-center text-white font-bold text-2xl">
                                {{ user.username.0|upper }}
                            </div>
                            {% endif %}
                        </div>
                        <div class="flex-1">
                            <a href="{% url 'ficha10:user_profile' user.user_id %}" class="block hover:text-blue-600">
                                <h3 class="font-semibold text-lg text-gray-900">
                                    {{ user.first_name }} {{ user.last_name }}
                                </h3>
                                <p class="text-gray-600">@{{ user.username }}</p>
                            </a>
                            {% if user.bio %}
                            <p class="mt-2 text-sm text-gray-500">{{ user.bio }}</p>
                            {% endif %}
                            {% if user.location %}
                            <p class="mt-1 text-sm text-gray-500">
                                <i class="fas fa-map-marker-alt mr-1"></i>{{ user.location }}
                            </p>
                            {% endif %}
                        </div>
                    </div>
                    <div class="flex-shrink-0 ml-4">
                        {% if user.friendship %}
                            {% if user.friendship.status == 'accepted' %}
                            <span class="px-4 py-2 bg-green-100 text-green-700 rounded-lg">
                                <i class="fas fa-check mr-1"></i>Amigos
                            </span>
                            {% elif user.friendship.status == 'pending' %}
                            <span class="px-4 py-2 bg-yellow-100 text-yellow-700 rounded-lg">
                                <i class="fas fa-clock mr-1"></i>Pendente
                            </span>
                            {% elif user.friendship.status == 'blocked' %}
                            <span class="px-4 py-2 bg-red-100 text-red-700 rounded-lg">
                                <i class="fas fa-ban mr-1"></i>Bloqueado
                            </span>
                            {% endif %}
                        {% else %}
                        <a href="{% url 'ficha10:send_friend_request' user.user_id %}" 
                           class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                            <i class="fas fa-user-plus mr-1"></i>Adicionar Amigo
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-16">
            <i class="fas fa-search text-6xl text-gray-300 mb-4"></i>
            <h3 class="text-xl font-semibold text-gray-700 mb-2">Nenhum resultado encontrado</h3>
            <p class="text-gray-500">Tente pesquisar com outros termos</p>
        </div>
        {% endif %}
    </div>
    {% else %}
    <div class="bg-white rounded-lg shadow-md text-center py-16">
        <i class="fas fa-search text-6xl text-gray-300 mb-4"></i>
        <h3 class="text-xl font-semibold text-gray-700 mb-2">Pesquise por utilizadores</h3>
        <p class="text-gray-500">Digite um nome ou username na caixa de pesquisa acima</p>
    </div>
    {% endif %}
</div>
{% endblock %}
